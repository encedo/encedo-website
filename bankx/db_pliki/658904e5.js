var dbnextDashboardModule=angular.module("dbnext-dashboard",["platform"]).config(["$urlRouterProvider","stateServiceProvider","pathServiceProvider","guiProvider","translationsLoaderProvider",function(a,b,c,d,e){webComponentRegistry["dbnext-dashboard"].simpleName="dashboard",e.addTranslationsPath(c.generateRootPath("dbnext-dashboard")+"/i18n/messages_{{language}}.json"),d.registerElement("dbnext-dashboard","menu"),a.otherwise("/de/dashboard"),b.state("de",{url:"/de","abstract":!0,template:"<div ui-view></div>"}).state("de.dashboard",{url:"/dashboard",templateUrl:c.generateTemplatePath("dbnext-dashboard")+"/views/dashboard.html",controller:"dbnext.dashboard.DashboardController"})}]).run(function(){});dbnextDashboardModule.controller("dbnext.dashboard.DashboardController",["$scope","$rootScope","$timeout","$interval","widgetService","pathService","$modal","gate","userService","events","gui","guiEditor","customerService","$cookies","cookies",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.editMode=!1,a.showProducts=!0,a.emptyProducts=[],o("dashboarddate",(new Date).getTime()),b.dashboardDate||(b.dashboardDate=d(function(){console.log("dashboarddate cookie:",n.dashboarddate),n.dashboarddate||b.$emit("eb.session.accessDenied")},5e3)),a.enterEditMode=function(){l.setEditMode("widget").then(function(){a.editMode=!0})},a.commitChanges=function(){l.saveEditState("dbnext-dashboard.settings").then(function(){a.editMode=!1})},a.revertChanges=function(){l.revertEditState(),a.editMode=!1},a.addWidget=function(a){return k.getHiddenElements("widget").then(function(b){return l.activateWidget(a)})},a.getWidgetUrl=function(a){return e.getWidgetViewUrl(a,"dashboard")},a.setupHiddenWidgets=function(){a.hiddenWidgetsPromise=k.getHiddenElements("widget").then(function(b){a.hiddenWidgets=b})},a.setupHiddenWidgets(),a.showModal=function(){var b=angular.element(document.getElementById("main"));b.addClass("fade-out-content"),g.open({templateUrl:f.generateTemplatePath("dbnext-dashboard")+"/views/addWidgetModal.html",size:"sm",windowClass:"inline-modal",scope:a}).result["finally"](function(){b.removeClass("fade-out-content")})},a.$on("ebp.applications.editModeStart",function(b,c){"widget"===c&&l.setHiddenElements(a.hiddenWidgets)}),a.$on("ebp.applications.editModeEnd",a.setupHiddenWidgets),a.isAtLeastOneWidgetActive=function(){for(var b=a.hiddenWidgets,c=0;c<b.length;c++)if(!b[c].active)return!0;return!1},j.listener(a,"de.product.noData",function(b,c){if(a.emptyProducts.push(c),4==a.emptyProducts.length)a.showProducts=!1;else{for(var d=0,e=0;e<a.emptyProducts.length;e++)"deposits"===a.emptyProducts[e]?(a.alternativeProducSectiontDisplayMode=!0,d++):"accounts"===a.emptyProducts[e]&&d++;2==d&&(a.showProducts=!1)}}),a.footer={phoneNumbers:[{view:"801 18 18 18",model:"tel:801181818"},{view:"+48 12 625 80 00",model:"tel:+48126258000"},{view:"+48 500 919 000",model:"tel:+48500919000"}],options:[{link:"https://www.deutschebank.pl/easynet",message:"security"},{link:"https://www.deutschebank.pl/waluty.html",message:"exchange_rates"},{link:"https://www.deutschebank.pl/oprocentowanie_ind",message:"interest"}]},a.widgetsLoaded=!1,a.$on("ebp.applications.editStateChange",function(){a.widgetsLoaded=!0}),m.getUserData().then(function(a){b.$broadcast("externalDataReady",a)})}]),dbnextDashboardModule.directive("dbLayBox",["pathService","gui","$timeout",function(a,b,c){return{restrict:"EA",replace:!0,transclude:!0,templateUrl:a.generateTemplatePath("dbnext-dashboard")+"/directives/dbDshBox/dbDshBox.html",scope:{miniappName:"@",widgetName:"@",productCount:"@",eventHandler:"&ngClick"},link:function(a,d){a.widget=b.getElement(a.miniappName,"widget",a.widgetName),a.$on("dataLoaded",function(){a.loaded=!0,console.log("test")}),c(function(){a.loaded=!0},300)}}}]),dbnextDashboardModule.directive("dbLayTile",["$state","ebTheming","gui","guiEditor","pathService","eventTracker","$timeout","events","$window",function(a,b,c,d,e,f,g,h,i){return{restrict:"EA",replace:!0,transclude:!0,scope:{miniappName:"@",widgetName:"@",productCount:"@",eventHandler:"&ngClick"},templateUrl:e.generateTemplatePath("dbnext-dashboard")+"/directives/dbDshTile/dbDshTile.html",link:function(e,j){b.applyTheme(j),e.loaded=!1,e.$on("dataLoaded",function(){e.loaded=!0}),e.$watch("productCount",function(a){parseInt(a)>0&&g(function(){k()},300)}),angular.element(i).bind("resize",function(){k(),e.$digest()});var k=function(){var a=j[0].offsetWidth,b=j[0].querySelector(".widget-header").querySelector("div.title").offsetWidth,c=j[0].querySelector(".widget-tile-content").querySelector(".widget-content-inner");if(null!=c.querySelector(".box-action-panel")){var d=c.querySelector(".box-action-panel").querySelector(".action-button").querySelector(".eb-button"),e=d.offsetWidth,f=d.querySelector("i").offsetWidth,g=d.querySelector("span");b+e>a-30?(e=a-b-15,d.style.width=e+"px",g.style.width=e-f-30+"px"):(d.style.width="auto",g.style.width="auto")}};g(function(){e.loaded=!0,k()},300),e.sectionName="widget",e.widget=c.getElement(e.miniappName,e.sectionName,e.widgetName),e.moveUp=function(){e.movePossibility.up&&d.moveElementUp(e.widget)},e.moveDown=function(){e.movePossibility.down&&d.moveElementDown(e.widget)},e.moveLeft=function(){e.movePossibility.left&&d.moveElementLeft(e.widget)},e.moveRight=function(){e.movePossibility.right&&d.moveElementRight(e.widget)},e.removeWidget=function(){d.disactivateWidget(e.widget)},e.getMovePossibility=function(){return d.getMovePossibility(e.widget,e.sectionName)},"widget"===d.editSectionName&&(e.editMode=!0),e.$on("ebp.applications.editModeStart",function(){e.widget.editable&&(e.editMode=!0)}),e.$on("ebp.applications.editModeEnd",function(){e.editMode=!1}),e.$on("ebp.applications.editStateChange",function(){e.movePossibility=e.getMovePossibility()}),e.goTo=function(){e.editMode||(f(e.widget,"dashboard"),a.go(e.widget.miniapp.startState))},e.$watch("editMode",function(a){a&&(e.movePossibility=e.getMovePossibility())}),h.broadcast("ebp.applications.editStateChange")}}}]),dbnextDashboardModule.controller("dbnext.dashboard.MenuElementController",["$scope","$rootScope",function(a,b){a.isStateActive=b.isStateActive}]),angular.module("dbnext-dashboard").run(["$templateCache",function(a){a.put("templates/dbnext-dashboard/0.0.2/directives/dbDshBox/dbDshBox.html",'<div class="db-dsh-box widget-tile" ng-class="{\'tile-ready\': loaded }" ng-click="goTo()"><div class="widget-header"><div ng-class="\'widget-title-\' + widget.miniapp.simpleName + \'-\' + widget.name" class="title"><span eb-msg reference-key="widget.miniapp.simpleName + \'.\' + widget.name + \'.title\'"></span></div></div><div class="widget-tile-content"><div ng-transclude class="widget-content-inner"></div></div></div>'),a.put("templates/dbnext-dashboard/0.0.2/directives/dbDshTile/dbDshTile.html",'<div id="{{widget.name}}" class="db-dsh-tile widget-tile" ng-class="{ \'editable\': editMode && widget.editable != false, \'tile-ready\': loaded }" ng-click="goTo()"><div class="widget-header"><div ng-class="\'widget-title-\' + widget.miniapp.simpleName" class="title"><span eb-msg reference-key="widget.miniapp.simpleName + \'.title\'"></span> <span ng-if="productCount > 0">({{productCount}})</span></div></div><div class="widget-tile-content"><div ng-transclude class="widget-content-inner"></div><div ng-if="editMode" class="widget-edit-content"><div class="edit-buttons"><span class="edit-button" ng-show="movePossibility.left" ng-click="moveLeft(widget)"><i eb-themable class="eb-icon edit-icon-tile-move-left"></i></span> <span class="edit-button" ng-show="movePossibility.right" ng-click="moveRight(widget)"><i eb-themable class="eb-icon edit-icon-tile-move-right"></i></span> <span class="edit-button" ng-show="movePossibility.up" ng-click="moveUp(widget)"><i eb-themable class="eb-icon edit-icon-tile-move-top"></i></span> <span class="edit-button" ng-show="movePossibility.down" ng-click="moveDown(widget)"><i eb-themable class="eb-icon edit-icon-tile-move-bottom"></i></span> <span class="edit-button" ng-click="removeWidget(widget)"><i eb-themable class="eb-icon edit-icon-tile-remove"></i></span></div></div></div></div>'),a.put("templates/dbnext-dashboard/0.0.2/elements/menu/dashboard-menuElementView.html",'<li ng-class="{\'active\': isStateActive(\'de.dashboard\')}" ng-controller="dbnext.dashboard.MenuElementController" ui-sref="de.dashboard"><span eb-themable class="eb-icon eb-ico-menu-dashboard"></span> <span eb-msg="db.dashboard.left_menu.element.dashboard"></span></li>'),a.put("templates/dbnext-dashboard/0.0.2/views/addWidgetModal.html",'<div class="add-widget-modal" eb-title="platform.dashboard.add_widget_modal.title"><div class="eb-modal-header"><span class="title" eb-msg="platform.dashboard.add_widget_modal.select"></span> <span class="header-buttons"><div ng-click="$close()" eb-themable class="header-button close-btn eb-icon eb-ico-close"></div></span></div><ng-switch on="isAtLeastOneWidgetActive()"><div ng-switch-when="true" class="widget-list-placeholder"><ul class="widget-list"><!--\n          --><li class="widget-tile-modal animate-on widget-tile-animation" ng-repeat="widget in hiddenWidgets" eb-single-click="addWidget(widget)"><eb-preloader eb-promise="hiddenWidgetsPromise" style="padding-bottom: 50px"></eb-preloader><div class="widget-tile-modal-inner"><div class="widget-tile-modal-title">{{::(widget.miniapp.simpleName + \'.title\')|translate}}</div><div class="widget-tile-modal-ico"><i eb-themable class="tile-ico eb-icon" ng-class="\'eb-ico-widget-\' + widget.miniapp.simpleName "></i></div><div class="widget-tile-modal-add-btn">{{::\'platform.dashboard.add_widget_modal.add\'|translate}}</div></div></li><!--\n      --></ul></div><div ng-switch-when="false" class="no-widgets-to-add-msg">{{::\'platform.dashboard.add_widget_modal.empty\'|translate}}</div></ng-switch></div>'),a.put("templates/dbnext-dashboard/0.0.2/views/dashboard.html",'<div id="dashboard"><div class="dashboard" ng-class="{ \'dashboard-edit-mode\' : editMode, \'dashboard-view-mode\' : !editMode }"><div class="dashboard-header" class="ng-hide"><div class="title"><span eb-msg="platform.dashboard.title"></span></div><div class="dashboard-actions"><a ng-click="enterEditMode()" ng-if="!editMode"><div eb-themable class="edit-enter-icon eb-ico-settings eb-icon"></div></a> <a ng-click="commitChanges()" ng-if="editMode"><span eb-themable class="eb-icon eb-ico-confirm commit-changes-button">&nbsp;</span></a> <a ng-click="revertChanges()" ng-if="editMode"><span eb-themable class="eb-icon eb-ico-close revert-changes-button">&nbsp;</span></a></div><eb-login-info external-data="true" ng-show="!editMode"></eb-login-info></div><div class="dashboard-container" class="ng-hide"><span class="eb-gui-section" ng-show="editMode"><span class="eb-gui-section-element column-3 add-widget-element"><span class="box-base box box-add-tile" ng-click="showModal()"><div class="box-add-tile-content"><div class="add-icon-placeholder"><i eb-themable class="eb-icon edit-icon-tile-add"></i></div><div class="box-add-label"><span eb-msg="platform.dashboard.widget_add"></span></div></div></span></span></span><div><div eb-gui-section="product" element-default-class="column-1" class="product-section" ng-class="{\'alternative-product-display-mode\': alternativeProducSectiontDisplayMode}" ng-show="showProducts"></div><div eb-gui-section="widget" element-default-class="column-1" class="default-section"></div></div></div><div class="dashboard-footer" ng-show="widgetsLoaded" class="ng-hide"><div class="footer-container"><div class="db-logo"><span class="db-logo-top"><span eb-msg="db.dashboard.footer.logo.top"></span></span> <span class="db-logo-bottom"><span eb-msg="db.dashboard.footer.logo.bottom"></span></span></div><!-- no whitespace fix\n             --><div class="db-help"><div class="footer-help-icon"><i eb-themable class="eb-icon eb-icon-basic-info eb-dbnext-theme"></i></div><!-- no whitespace fix\n                 --><div class="footer-help-info"><div class="footer-help-title"><span eb-msg="db.dashboard.footer.help.title"></span></div><div class="footer-help-phone-numbers"><a ng-repeat="phoneNo in footer.phoneNumbers" ng-href="{{::phoneNo.model}}"><!-- no whitespace fix --><span eb-msg="{{phoneNo.view}}"></span><span ng-if="!$last">,&nbsp;</span><!-- no whitespace fix --></a></div></div></div><!-- no whitespace fix\n             --><div class="db-options"><span ng-repeat="option in footer.options"><a ng-href="{{::option.link}}" target="_blank"><span eb-msg="{{\'db.dashboard.footer.options.\' + option.message}}"></span></a><!-- no whitespace fix\n                     --><span class="footer-options-joint" ng-if="!$last">|</span></span></div></div><div class="copyright-container"><span eb-msg="db.dashboard.footer.options.copyright"></span></div></div></div></div>')}]);